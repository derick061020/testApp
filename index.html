<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>YouTube Video Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { 
            font-family: sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            text-align: center; 
        }
        #youtube-url {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
        }
        #video-player {
            max-width: 100%;
            margin-top: 15px;
        }
        #pip-button {
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>YouTube Video Player(Ex: https://youtu.be/dQw4w9WgXcQ)</h1>
    <input type="text" id="youtube-url" placeholder="Pega aquí el enlace de YouTube">
    <button onclick="loadYouTubeVideo()">Reproducir</button>

    <div id="player-container">
        <img id="thumbnail" src="" style="max-width: 100%; display: none;">
        <video id="video-player" controls playsinline style="display: none;"></video>
        <button id="pip-button" onclick="enterPictureInPicture()">Picture-in-Picture</button>
    </div>

    <script>
        let currentVideoPlayer = null;

        async function loadYouTubeVideo() {
            const youtubeUrlInput = document.getElementById('youtube-url');
            const videoUrl = youtubeUrlInput.value.trim();
            const thumbnailEl = document.getElementById('thumbnail');
            const videoPlayerEl = document.getElementById('video-player');
            const pipButton = document.getElementById('pip-button');

            if (!videoUrl) {
                alert('Por favor, ingresa un enlace de YouTube');
                return;
            }

            try {
                const response = await fetch(`get_youtube_audio.php?url=${encodeURIComponent(videoUrl)}`);
                const data = await response.json();
                console.log(`get_youtube_audio.php?url=${encodeURIComponent(videoUrl)}`);

                if (data.error) {
                    throw new Error(data.error);
                }

                // Mostrar miniatura
                thumbnailEl.src = data.thumbnail_url;
                thumbnailEl.style.display = 'block';

                // Configurar y mostrar video
                videoPlayerEl.src = data.audio_url;
                videoPlayerEl.style.display = 'block';
                
                // Prevenir pausa automática
                videoPlayerEl.addEventListener('pause', preventAutoPause);
                
                // Reproducir
                await videoPlayerEl.play();

                // Habilitar Picture-in-Picture si está soportado
                if (document.pictureInPictureEnabled) {
                    pipButton.style.display = 'block';
                }

                currentVideoPlayer = videoPlayerEl;

                // Imprimir URLs en consola
                console.log('Video URL:', data.audio_url);
                console.log('Thumbnail URL:', data.thumbnail_url);

            } catch (error) {
                console.error('Error:', error);
                alert('No se pudo cargar el video. Verifica el enlace.');
            }
        }

        function preventAutoPause() {
            if (document.hidden && currentVideoPlayer) {
                currentVideoPlayer.play();
            }
        }

        async function enterPictureInPicture() {
            if (currentVideoPlayer && document.pictureInPictureEnabled) {
                try {
                    await currentVideoPlayer.requestPictureInPicture();
                } catch (error) {
                    console.error('Error entering PiP:', error);
                }
            }
        }

        // Prevenir pausa global
        document.addEventListener('visibilitychange', () => {
            if (currentVideoPlayer && document.hidden) {
                currentVideoPlayer.play();
            }
        });
    </script>
</body>
</html>